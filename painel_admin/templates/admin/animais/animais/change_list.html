{% extends "partials/sidebar.html" %}
{% load admin_list static %}


{% block extrastyle %}
<link rel="stylesheet" href="{% static "global/css/change_list.css" %}">
{% endblock extrastyle %}
{% block content-pad %}
<h1>Gerenciar Animais</h1>

<div class="search-content">
  <form method="get" class="search-container">
    <input type="text" name="q" placeholder="Buscar..." value="{{ cl.query }}">
    <button type="submit"><i class="fas fa-search"></i> Buscar</button>
  </form>

  {% if has_add_permission %}
    <a href="{{ add_url }}" class="btn-add">
      <i class="fas fa-plus"></i> Adicionar
    </a>
  {% endif %}
</div>


<form method="post" action="">
  {% csrf_token %}
  <div class="table-container">

    {% if has_add_permission or perms.animais.delete_animais%}
      <div class="actions-bar">
        {% if perms.animais.delete_animais %}
          <span id="selected-count">0 selecionados</span>
          <button type="submit"
          name="action"
          value="delete_selected"
          id="btn-remove"
                  class="btn-action"
                  disabled>
            <i class="fas fa-trash"></i> Remover selecionados
          </button>
        {% endif %}
      </div>
    {% endif %} 
  
      <div class="table-wrapper">
        {% result_list cl %}
      </div>
    </div>
  </form>

  {% if not cl.params.all|stringformat:"s" %}
  <div class="pagination-container">
    <h4>EXIBINDO TODOS OS REGISTROS</h4>
    <div class="pagination">
      <button type="button" class="arrow-btn" id="backToPaged">Voltar à paginação</button>
    </div>
  </div>
{% elif cl.paginator.num_pages > 1 %}
  <div class="pagination-container">
    <h4>VOCÊ ESTÁ NA PÁGINA</h4>
    <div class="pagination">

      {% if cl.page_num > 1 %}
        <button type="button" class="arrow-btn" id="prevPage">‹</button>
      {% else %}
        <button type="button" class="arrow-btn disabled" disabled>‹</button>
      {% endif %}

      <form id="pageForm" class="page-form" method="get">
        {% for key, value in cl.params.items %}
          {% if key != 'p' and key != 'all' %}
            <input type="hidden" name="{{ key }}" value="{{ value }}">
          {% endif %}
        {% endfor %}
        <input
          type="number"
          name="p"
          id="pageInput"
          value="{{ cl.page_num }}"
          min="1"
          max="{{ cl.paginator.num_pages }}"
          data-current="{{ cl.page_num }}">
      </form>

      <span class="divider"></span>
      <span class="page-total display-box">{{ cl.paginator.num_pages }}</span>

      {% if cl.page_num < cl.paginator.num_pages %}
        <button type="button" class="arrow-btn" id="nextPage">›</button>
      {% else %}
        <button type="button" class="arrow-btn disabled" disabled>›</button>
      {% endif %}

      <button type="button" class="show-all-btn" id="showAll">Mostrar tudo</button>
    </div>
  </div>
{% endif %}
{% endblock %}

{% block extrajs %}
  <script>
      window.addEventListener('DOMContentLoaded', function () {
    const toggle = document.getElementById('action-toggle');
    const checks = document.querySelectorAll('.action-select');

    if (toggle && checks.length) {
      toggle.addEventListener('change', function () {
        checks.forEach(c => c.checked = toggle.checked);
      });
    }
  });


  document.addEventListener('DOMContentLoaded', () => {
  const countEl  = document.getElementById('selected-count');
  const btnRemove= document.getElementById('btn-remove');
  const checkAll = document.getElementById('action-toggle');
  const checks   = Array.from(document.querySelectorAll('input.action-select'));

  function refreshActions() {
    const checkedCount = checks.filter(c => c.checked).length;
    countEl.textContent = checkedCount
      ? `${checkedCount} selecionado${checkedCount>1?'s':''}`
      : '0 selecionados';
    btnRemove.disabled = checkedCount === 0;
  }

  checks.forEach(c => c.addEventListener('change', refreshActions));

  if (checkAll) {
    checkAll.addEventListener('change', () => {
      checks.forEach(c => c.checked = checkAll.checked);
      refreshActions();
    });
  }

  refreshActions();
});

  </script>
{% endblock extrajs %}

